local DAMAGE = 5           -- damage each time
local DELAY = 1            -- seconds between damage
local part = script.Parent

local playersInZone = {}   -- remember who is inside


-- When someone touches the part
part.Touched:Connect(function(hit)
	local hum = hit.Parent:FindFirstChild("Humanoid")
	if hum == nil then return end

	local player = game.Players:GetPlayerFromCharacter(hit.Parent)
	if player == nil then return end

	-- If already draining, don't start again
	if playersInZone[player] then return end
	playersInZone[player] = true

	-- Damage loop
	task.spawn(function()
		while playersInZone[player] do
			hum:TakeDamage(DAMAGE)
			task.wait(DELAY)
		end
	end)
end)


-- When someone stops touching the part
part.TouchEnded:Connect(function(hit)
	local player = game.Players:GetPlayerFromCharacter(hit.Parent)
	if player ~= nil then
		playersInZone[player] = nil
	end
end)
